<!doctype html>
<html lang="en" class="h-full bg-gray-50">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Agent Messenger Quick Start</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
    <style>
      .CodeMirror {
        height: auto;
        border-radius: 0.375rem;
        font-size: 0.875rem;
        padding: 0.5rem;
      }
    </style>
  </head>
  <body class="h-full">
    <div class="min-h-full">
      <div class="bg-white shadow">
        <div class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8">
          <h1 class="text-3xl font-bold tracking-tight text-gray-900">AI Agent Messenger Quick Start</h1>
        </div>
      </div>
      <main>
        <div class="mx-auto max-w-7xl py-6 sm:px-6 lg:px-8">
          <div class="px-4 py-6 sm:px-0">
            <div class="flex gap-6">
              <div class="w-2/3 overflow-hidden bg-white shadow sm:rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                  <div class="space-y-6">
                    <!-- Required Section -->
                    <div class="border-b border-gray-200 pb-6">
                      <h2 class="text-2xl font-bold leading-6 text-gray-900">Getting Started</h2>
                      <p class="mb-6 mt-3 text-base text-gray-500">
                        This guide demonstrates how to integrate the AI Agent Messenger using vanilla JavaScript, making it easy to implement in any browser environment without additional dependencies.
                      </p>
                      <div>
                        <h3 class="text-lg font-medium leading-6 text-gray-900">
                          Step 1. Install AI Agent SDK
                        </h3>
                        <p class="mt-2 text-sm text-gray-500">
                          Add the AI Agent SDK to your web page by importing it as a module.
                        </p>
                        <div class="mt-4">
                          <textarea id="loadScript" class="code-editor-html">
<script type="module">
    import { loadMessenger } from "https://aiagent.sendbird.com/orgs/default/index.js";
</script></textarea>
                        </div>

                        <h3 class="text-lg font-medium leading-6 text-gray-900 mt-6">
                          Step 2. Initialize Messenger
                        </h3>
                        <p class="mt-2 text-sm text-gray-500">
                          The messenger will be initialized and opened automatically after 2 seconds.
                        </p>
                        <div class="mt-4">
                          <textarea id="initializeCode" class="code-editor-js">
const messenger = await loadMessenger();
await messenger.initialize({
  appId: 'APP_ID',
  aiAgentId: 'AI_AGENT_ID',
});

// open the messenger automatically after 2 seconds
setTimeout(() => {
  messenger.open();
}, 2000);
</textarea>
                        </div>
                      </div>
                    </div>
                    
                    <!-- Advanced Section -->
                    <div class="pt-6">
                      <h2 class="text-xl font-bold leading-6 text-gray-900 mb-6">Advanced Features</h2>
                      
                      <div class="space-y-8">
                        <div>
                          <h3 class="text-lg font-medium leading-6 text-gray-900">Switch Application</h3>
                          <p class="mt-2 text-sm text-gray-500">Change to a different application configuration.</p>
                          <div class="mt-4">
                            <textarea id="updateConfigCode" class="code-editor-js">
await messenger.updateConfig({
  appId: 'NEW_APP_ID',
  aiAgentId: 'NEW_AI_AGENT_ID',
  // ... other config options
});</textarea>
                          </div>
                          <button id="updateConfigBtn" class="mt-3 inline-flex items-center rounded-md bg-[#742ddd] px-3 py-2 text-sm text-white shadow-sm hover:bg-[#6211c8]">
                            Update Config
                          </button>
                        </div>

                        <div>
                          <h3 class="text-lg font-medium leading-6 text-gray-900">User Authentication</h3>
                          <p class="mt-2 text-sm text-gray-500">Set up user authentication for personalized experience.</p>
                          <div class="mt-4">
                            <textarea id="updateSessionCode" class="code-editor-js">
await messenger.updateUserSession({
  userId: 'new_user_id',
  authToken: 'new_auth_token',
  // this callback should handle session token refresh:
  onSessionTokenRequest: async () => {
      const response = await fetch('new-token-endpoint');
      return response.token;
  }
});</textarea>
                          </div>
                          <button id="updateSessionBtn" class="mt-3 inline-flex items-center rounded-md bg-[#742ddd] px-3 py-2 text-sm text-white shadow-sm hover:bg-[#6211c8]">
                            Update Session
                          </button>
                        </div>

                        <div>
                          <h3 class="text-lg font-medium leading-6 text-gray-900">Manual Controls</h3>
                          <p class="mt-2 text-sm text-gray-500">Manually control the messenger visibility.</p>
                          <div class="mt-4">
                            <textarea id="controlCode" class="code-editor-js">
function openAgent() {
  if (!messenger) return;
  messenger.open();
}

function closeAgent() {
  if (!messenger) return;
  messenger.close();
}</textarea>
                          </div>
                          <div class="mt-3 space-x-3">
                            <button id="openBtn" class="inline-flex items-center rounded-md bg-[#742ddd] px-3 py-2 text-sm text-white shadow-sm hover:bg-[#6211c8]">
                              Open Messenger
                            </button>
                            <button id="closeBtn" class="inline-flex items-center rounded-md bg-[#742ddd] px-3 py-2 text-sm text-white shadow-sm hover:bg-[#6211c8]">
                              Close Messenger
                            </button>
                          </div>
                        </div>

                        <div>
                          <h3 class="text-lg font-medium leading-6 text-gray-900">Conversation List Display</h3>
                          <p class="mt-2 text-sm text-gray-500">Display conversation list in a designated area without launcher.</p>
                          <div class="mt-4">
                            <textarea id="customDisplayCode" class="code-editor-js">
await messenger.initialize({
  appId: 'APP_ID',
  aiAgentId: 'AI_AGENT_ID',
  // Use ConversationList component to display only the conversation list UI without the messenger
  // And you can access to the AI Agent Messenger and React instance via first argument
  customMainComponent: ({ messenger, react }) => (props) => {
    return react.createElement(messenger.AgentProviderContainer, props, [
      react.createElement(messenger.ConversationList),
    ]);
  }
});
</textarea>
                          </div>
                          <button id="renderConversationListBtn" class="mt-3 inline-flex items-center rounded-md bg-[#742ddd] px-3 py-2 text-sm text-white shadow-sm hover:bg-[#6211c8]">
                            Open Conversation List
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Code Editor -->
    <script>
      const editors = {};
      const configs = {
        mode: 'javascript',
        theme: 'dracula',
        readOnly: true,
        viewportMargin: Infinity,
        height: 'auto'
      }
      document.querySelectorAll('.code-editor-js').forEach((element) => {
        editors[element.id] = CodeMirror.fromTextArea(element, configs);
      });
      document.querySelectorAll('.code-editor-html').forEach((element) => {
        editors[element.id] = CodeMirror.fromTextArea(element, { ...configs, mode: 'xml' });
      });
    </script>

    <!-- Live Demo -->
    <script type="module">
      import { loadMessenger } from 'https://aiagent.stg.sendbirdtest.com/orgs/default/index.js';

      const messenger = await loadMessenger();
      await messenger.initialize({
        appId: import.meta.env.VITE_APP_ID,
        aiAgentId: import.meta.env.VITE_AI_AGENT_ID,
        customApiHost: import.meta.env.VITE_CUSTOM_API_HOST,
        customWebSocketHost: import.meta.env.VITE_CUSTOM_WS_HOST,
        rootElement: document.getElementById('messenger-container'),
      });
        
      // open the messenger automatically after 2 seconds
      setTimeout(() => {
        messenger.open();
      }, 2000);

      document.getElementById('updateConfigBtn').addEventListener('click', () => {
        messenger.updateConfig({
          // try to switch to another app
          appId: import.meta.env.VITE_NEW_APP_ID,
          aiAgentId: import.meta.env.VITE_NEW_AI_AGENT_ID,
          customApiHost: import.meta.env.VITE_NEW_CUSTOM_API_HOST,
          customWebSocketHost: import.meta.env.VITE_NEW_CUSTOM_WS_HOST,
        });
      });
      document.getElementById('updateSessionBtn').addEventListener('click', () => {
        messenger.updateUserSession({
          // try to use an existing test user with its auth token
          userId: import.meta.env.VITE_USER_ID,
          authToken: import.meta.env.VITE_USER_AUTH_TOKEN,
          onSessionTokenRequest: async (resolve) => resolve(import.meta.env.VITE_USER_AUTH_TOKEN),
        });
      });

      document.getElementById('openBtn').addEventListener('click', () => {
        if (!messenger) return;
        messenger.open();
      });

      document.getElementById('closeBtn').addEventListener('click', () => {
        if (!messenger) return;
        messenger.close();
      });

      document.getElementById('renderConversationListBtn').addEventListener('click', async () => {
        messenger.destroy();
        const conversationListMessenger = await loadMessenger({
          customMainComponent: ({ messenger, react }) => (props) => {
            return react.createElement(messenger.AgentProviderContainer, props, [
              react.createElement(messenger.ConversationList),
            ]);
          }
        });
        await conversationListMessenger.initialize({
          appId: import.meta.env.VITE_APP_ID,
          aiAgentId: import.meta.env.VITE_AI_AGENT_ID,
          customApiHost: import.meta.env.VITE_CUSTOM_API_HOST,
          customWebSocketHost: import.meta.env.VITE_CUSTOM_WS_HOST,
          rootElement: document.getElementById('messenger-container'),
        });
      });
    </script>
  </body>
</html>
