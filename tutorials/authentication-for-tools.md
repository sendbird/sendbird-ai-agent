# Authentication for Tools

When integrating Sendbird AI Agent with your client app, you will consider how you can authenticate data requests coming from AI agents while handling user inquiries. In general, you need authentication process on two layers:

<table><thead><tr><th width="102.546875">Layer</th><th width="239.828125">Communication</th><th width="243.00390625">Data flow</th><th>Authentication</th></tr></thead><tbody><tr><td>Client app</td><td>when a user tries to start a conversation with AI agent</td><td>User device ↔ Sendbird server</td><td>Session token</td></tr><tr><td>Backend</td><td>when AI agent needs to make a Tools call to your API</td><td>Sendbird server ↔ Your server</td><td>X-Signature, Static token, JWT</td></tr></tbody></table>

Each layer requires a different approach to authentication and implementation. This guide focuses on authenticating the AI agent’s [Tool](../dashboard-guide/shared-assets/tools.md) calls on the backend.

{% hint style="info" %}
To learn more about user authentication on the client layer, see our SDK Quick start guide for [iOS](../sdk-docs/ios/quickstart-guide-messenger.md#manage-user-sessions), [Android](../sdk-docs/android/quickstart-guide-messenger.md#manage-user-sessions), [JavaScript](../sdk-docs/javascript-cdn/quickstart-guide-messenger.md#manage-user-sessions), and [React](../sdk-docs/react-npm/quickstart-guide-messenger.md#manage-user-sessions).
{% endhint %}

***

## Technical requirements

Before implementing the authentication flow for AI agent and its [Tools](../dashboard-guide/shared-assets/tools.md) requests, make sure that your environment meets the following technical requirements:

### Backend development

* RESTful API endpoints where AI Agent can send tool requests.
* Authentication logic with either a signature or token verification implementation.
* User `context` object: Map Sendbird `user_id` to your user system.
* Platform API Integration for user creation and session token management.

### Security

* Master API tokens must be managed and stored only on the server side.
* Implement a proper token storage. This is required for environment variables and secrets management.
* Rate limits and access control for AI Agent's tool requests.

***

## Authentication for Tools

[Tools](../dashboard-guide/shared-assets/tools.md) are one of the AI agent features that enables the agent to make authenticated API calls to your backend services (API service) when processing user requests. If a request is submitted, the agent will make an API call to a server's endpoint. To authenticate these tool calls, the following three methods are employed:

* Basic authentication
* With Sendbird `user_id`
* With a JWT generated by your server

### Basic authentication

When a user information doesn't need to be verified, the basic authentication can be implemented as follows:

1. A user opens your client app and enters Sendbird AI agent messenger.
2. The user sends a message to an AI agent.
3. Based on their message, the AI agent determines that it needs to call an API.
4. Then AI agent sends an authenticated request to your endpoint.
5. A middleware determines if the user has permission to make the API call.
6. Your server processes the request and returns its response to the AI agent.
7. The AI agent provides an answer to the user using the data in the response body.

#### How to implement

To authenticate the request from the AI agent, you can use either of the options below:

#### **Option 1: X-Sendbird-Signature (Secure)**

* Security: High as a dynamic signature required per request.
* Method: HMAC-SHA256 signature using your Sendbird master API token.
  * Sendbird master API token can be found under **Workspace settings > General > API authentication & base URL** in Sendbird AI agent dashboard.
* Header: `x-sendbird-signature: [calculated_signature]`

```python
import hmac
import hashlib

def verify_sendbird_signature(api_token, payload, signature):
    key = api_token.encode('utf-8')
    calculated_signature = hmac.new(
        key, 
        payload.encode('utf-8'), 
        hashlib.sha256
    ).hexdigest()
    
    return hmac.compare_digest(calculated_signature, signature)
```

#### **Option 2: Static token**

* Security: Medium as it utilizes a fixed token.
* Method: Bearer token in Authorization header
* Header: `Authorization: Bearer {static_token}`

{% hint style="info" %}
This method requires a token rotation policy on your side.
{% endhint %}

### With Sendbird `user_id`

You can consider authenticate the AI agent's call with an **API scoping check.** While following the basic authentication flow, the Sendbird server also provides the user's Sendbird `user_id`, which is automatically generated and provided during server-to-server calls.

This is how a Tools call will be authenticated and performed with Sendbird `user_id`:

1. A user opens your client app and enters Sendbird AI agent messenger.
2. The user sends a message to an AI agent.
3. Based on their message, the AI agent determines that it needs to call an API.
4. Then the AI agent sends an authenticated request using the unique ID of the user to your endpoint.
   * `user_id` is provided by the Sendbird server.
5. A middleware determines if the user has permission to make the API call.
6. Your server processes the request and returns its response to the AI agent.
7. The AI agent provides an answer to the user using the data in the response body.

### With a JSON Web Token (JWT) generated by your server

For **high-risk endpoints**, issue a scoped, short-lived JSON Web Token (JWT) on your server and require other actors to pass it to your API when sending a request. Authentication flow with a JWT shares the basic authentication process described above, but your server also verifies the user’s JWT tokens and their access scope.

This is how a [Tools](../dashboard-guide/shared-assets/tools.md) call will be authenticated and performed:

1. A user opens your client app and enters Sendbird AI agent messenger.
2. This action prompts a request for a JWT, which contains information on the access scope.
3. Sendbird AI agent messenger channel then populates a `context` object with the JWT.
4. The user sends a message to Sendbird AI agent.
5. Based on the user's message, the AI agent determines that it needs to call one of your APIs.
6. Then the AI agent sends an authenticated request using the unique ID and JWT token provided the user to your endpoint.
   * `user_id` is provided by the Sendbird server.
   * The JWT `token` is from the context object in the messenger channel.
7. A middleware determines if the user has permission to make the API call.
8. Your server processes the request and returns its response to the AI agent.
9. The AI agent provides an answer to the user using the data in the response body.

***

## Things to consider

For a smooth operation, take the items below into account when setting up your server environment for Sendbird AI agent and its [Tools](../dashboard-guide/shared-assets/tools.md) call authentication.

### Development requirements

<table><thead><tr><th>Category</th><th width="446.14453125">Action item</th><th>Timeline</th></tr></thead><tbody><tr><td>Backend setup</td><td><ul><li>Implement an authentication method of your choice.</li><li>Build API endpoints required for the AI agent operation.</li><li>Platform API integration setup.</li><li>Allow Sendbird IP for inbound traffic.</li></ul></td><td>1-2 weeks</td></tr><tr><td>Client app integration</td><td><ul><li>SDK integration and session management.</li><li>Implement UI/UX for AI agent.</li><li>Tests and error handling.</li></ul></td><td>1-2 weeks</td></tr><tr><td>Integration test</td><td><ul><li>End-to-end authentication flow test</li><li>Load test and optimization</li></ul></td><td>1 week</td></tr></tbody></table>

### API Integration checklist

Refer to the following check list when integrating SDK and Sendbird Platform APIs.

#### Pre-development

* [ ] Choose an authentication method (X-Signature or static token).
* [ ] Create a Sendbird application in Sendbird AI agent dashboard and obtain API tokens.
* [ ] Design API endpoints for AI Agent-related functionalities.
* [ ] Plan a user and session token management policy.

#### Development

* [ ] Implement an authentication logic for backend.
* [ ] Create API endpoints for AI agent's Tool calls.
* [ ] Integrate Sendbird Platform API for user and token management.
* [ ] Implement client-app SDK integration.
* [ ] Implement a session management and refresh logic.

#### Testing & deployment

* [ ] Test the authentication flow end-to-end.
* [ ] Validate token expiration and renewal.
* [ ] Test AI Agent API calls to your backend via the dashboard.
* [ ] Perform a load test for authentication endpoints.
