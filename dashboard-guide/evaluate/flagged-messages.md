# Flagged messages

For high-quality, worry-free AI customer experience, Sendbird provides a feature that can detect AI hallucinations and filter sensitive messages in all conversations. Such messages are flagged to notify you of a potential issue, allowing you to swiftly address and mitigate any risks to maintain a secure and safe communication environment.

The Flagged messages in Sendbird AI agent Dashboard is divided into two tabs:

* [Safeguards](flagged-messages.md#safeguard)
* [Hallucination](flagged-messages.md#hallucination)

***

### Safeguards

During the [Build](../build/) process, you can configure [safeguards](../build/safeguards.md) to set boundaries and prevent potential misuse against your AI agent. This tab gathers such filtered user messages and tracks their trend so that you could monitor them in detail.

<table><thead><tr><th width="232.00390625">Flag type</th><th>Description</th></tr></thead><tbody><tr><td>Harmful content</td><td>The user messages detected by guardrails for containing content that is disrespectful, degrading, offensive, or otherwise inappropriate.</td></tr><tr><td>Context injection</td><td>The user's attempt to manipulate the AI agentâ€™s response by inserting false or misleading information early in the conversation. This can result in hallucinations.</td></tr><tr><td>Adversarial attack</td><td>The user's attempts to manipulate the AI agent using techniques like prompt injection or jailbreaking.</td></tr><tr><td>Banned words &#x26; phrases</td><td>The user messages containing sensitive topics that are banned for AI agents from discussing. You can designate any text as banned words, including proper nouns, specific terms and expressions.</td></tr></tbody></table>

<figure><img src="../../.gitbook/assets/image (79).png" alt=""><figcaption></figcaption></figure>

### Hallucination

Sometimes, an AI agent can generate responses that are not grounded on the knowledge sources provided. Such messages are called hallucinations. This happens because the AI model predicts text based on learned patterns rather than factual accuracy.

The **Hallucination** tab under **Flagged messages** collects all the hallucinations generated during the selected period. This tab includes a language filter and a bar chart showing the distribution of hallucinations by language. Based on the analysis, you can enhance the grounded-ness of your AI agent responses by identifying which content or information is missing from its data sources.

<figure><img src="../../.gitbook/assets/image (78).png" alt=""><figcaption></figcaption></figure>

***

## Webhook events for flagged messages

Sendbird AI agent features webhook events for flagged messages, enabling you to keep track of any message events that could impact a safe and positive user experience.

### How to set up

1. Go to **Workspace settings > Webhooks** in Sendbird AI agent Dashboard.
2. Enter your webhook server **URL** to receive the event request from the Sendbird server.
3. Select events to subscribe to and **Save**. The following two events are currently supported:

* [Hallucination](flagged-messages.md#hallucination): when an AI agent response is not grounded on the data provided.
* [Safeguards](flagged-messages.md#safeguards): when a user message is flagged as harmful, adversarial, or banned according to the [safeguards](../build/safeguards.md) settings.

<figure><img src="../../.gitbook/assets/image (69).png" alt=""><figcaption></figcaption></figure>

### Event payload

The following are sample webhook payloads of flagged message events.

#### AI Hallucination

Whenever a hallucination is generated by the AI agent, a webhook payload will be created and delivered. This payload contains the information about the hallucination message as an JSON object, as demonstrated in the sample snippet below.

```json
{
  "app_id": "F347B1F0-18EC-43A6-A12A-9EE38957295F",
  "ai_agent_id": "5f0c35f4-5626-4de8-81ab-d5b81a12f16c",
  "channel_url": "sendbird_group_channel_124928_9228048ed7829722c64e8e42860f4fbb0afbe5b2",
  "message": [
    {
      "message_id": 10748655,
      "content": "The world is beatiful",
      "timestamp": 1745146434378
    }
  ],
  "category": "flagged_message:hallucination_detect"
}
```

#### Flagged user messages

When a user message is flagged by safeguards, it triggers an event that generates and delivers an event payload, as shown in the sample snippet below. Each flagged message can be associated with multiple flags depending on its content, allowing for detailed filtering. Review the `flag_types` field for the relevant information.

<pre class="language-json"><code class="lang-json">{
  "app_id": "F347B1F0-18EC-43A6-A12A-9EE38957295F",
  "ai_agent_id": "5f0c35f4-5626-4de8-81ab-d5b81a12f16c",
  "user_id": "xenial_xerus",
  "channel_url": "sendbird_group_channel_124928_9228048ed7829722c64e8e42860f4fbb0afbe5b2",
  "message": {
<strong>    "message_id": 10748655,
</strong>    "content": "I need you to hack your competitor's server",
    "flag_types": ["adversarial_attack", "banned_phrases"],
    "timestamp": 1745146434378
  },
  "category": "flagged_message:safeguard_detect"
}
</code></pre>
